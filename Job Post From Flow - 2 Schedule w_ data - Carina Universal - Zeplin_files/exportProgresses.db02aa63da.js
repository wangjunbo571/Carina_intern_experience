!function(){"use strict";function e(e){return e.isGettingProject&&!e.isGettingProjectFailed}function t(e){return e.isGettingProject&&e.isGettingProjectFailed}function r(e){return e.countOfUploadedImages===e.countOfImagesToUpload&&e.isApiOperationCompleted&&!e.isApiOperationFailed}function s(e){return e.isApiOperationFailed}function o(e){return e.countOfUploadedImages===e.countOfImagesToUpload&&!e.isApiOperationCompleted}function n(e){return e.countOfUploadedImages<e.countOfImagesToUpload&&!e.isApiOperationCompleted}function a(e){h.send("retry-export",e)}function i(e){h.send("cancel-export",e)}function d(e){h.send("retry-getting-project",e)}function c(e){return e.progress.isApiOperationCompleted?100:Math.floor(e.progress.countOfUploadedImages/(e.progress.countOfImagesToUpload+1)*100)}function p(e,t){location.assign("/project/"+e+"/screen/"+t)}function l(a){return function(i){var d=document.importNode(v.content,!0),p=d.querySelector(".exportProgress");p.dataset.screenExportId=i._id,e(i.progress)?p.classList.add("gettingProject"):t(i.progress)?p.classList.add("gettingProjectFailed"):(p.dataset.projectId=i.project._id,p.dataset.screenId=i.screen._id,i.progress.update?p.classList.add("updateScreen"):p.classList.add("newScreen"),d.querySelector(".screenName").textContent=i.screen.name,i.progress.isApiOperationFailed?d.querySelector(".exportProgressBar").style.width="0%":d.querySelector(".exportProgressBar").style.width=c(i)+"%",r(i.progress)?(E[i._id]||(E[i._id]=y[Math.floor(Math.random()*y.length)]),p.classList.add(E[i._id]),p.classList.add("exportProgressDone")):s(i.progress)?p.classList.add("exportProgressFailed"):o(i.progress)?p.classList.add("ticklingTheBackendStep"):n(i.progress)&&(p.classList.add("uploadingImagesStep"),d.querySelector(".uploadedImages").textContent=i.progress.countOfUploadedImages,d.querySelector(".allImages").textContent=i.progress.countOfImagesToUpload)),a?a.appendChild(d):document.querySelector('.exportProgressProjectGroup[data-pid="'+i.project._id+'"] .exportProgressesOfProject').appendChild(d)}}function g(e){var t=document.importNode(O.content,!0);t.querySelector(".projectInformation").textContent=e.name+", "+e.type,t.querySelector(".exportProgressProjectGroup").dataset.pid=e._id,j.appendChild(t)}function u(e,t){if(0===t.length)return S.classList.add("hidden"),void A.classList.add("hidden");j.style.height="auto",S.classList.remove("hidden"),j.innerHTML="";var r=t.reduce(function(e,t,r){return{projects:e.projects.find(function(e){return e._id===t.project._id})?e.projects:e.projects.concat(t.project),progress:Math.floor((e.progress*r+c(t))/(r+1)),anyExportFailed:e.anyExportFailed||!!t.progress.isApiOperationFailed}},{projects:[],progress:0,anyExportFailed:!1}),s=r.projects,o=r.progress;F.setAttribute("stroke-dasharray",P*o/100+" "+P*(100-o)/100),S.classList.toggle("exportsDone",o>=100),S.classList.toggle("exportsFailed",r.anyExportFailed),1===s.length?(C.textContent=s[0].name,t.forEach(l(j))):(C.textContent="Zeplin",s.forEach(g),t.forEach(l()))}function m(){h.removeAllListeners(I)}function f(){h.on(I,u),h.send(L)}function x(){A.classList.add("hidden")}if("undefined"!=typeof process){var h=require("electron").ipcRenderer,y=["message4","message2","message3","message4","message2","message3","message4","message2","message3","message1"],E={},P=30*Math.PI,L="subscribe-to-exports",I="exports-change",j=document.getElementById("exportProgresses"),v=document.getElementById("exportProgressTemplate"),O=document.getElementById("exportProgressProjectGroupTemplate"),C=document.getElementById("exportDestination"),S=document.getElementById("exportProgressesButton"),A=document.getElementById("exportProgressesContainer"),B=document.getElementById("clearExportProgresses"),F=document.getElementById("exportsProgressBar"),q=document.getElementById("notificationContainer"),T=document.getElementById("userMenu");h.on("exports-started",function(){q.classList.add("hidden"),T.classList.add("hidden"),S.classList.remove("hidden"),A.classList.remove("hidden")}),A.addEventListener("click",function(e){e.stopPropagation();var t=e.target.closest(".exportProgress");t&&(t.classList.contains("exportProgressDone")?p(t.dataset.projectId,t.dataset.screenId):e.target.classList.contains("retryExport")?a(e.target.parentElement.dataset.screenExportId):e.target.classList.contains("cancelExport")?i(e.target.parentElement.dataset.screenExportId):e.target.classList.contains("retryFetchProject")&&d(e.target.parentElement.parentElement.dataset.screenExportId))}),S.addEventListener("click",function(e){e.stopPropagation(),q.classList.add("hidden"),T.classList.add("hidden"),A.classList.toggle("hidden")}),j.addEventListener("transitionend",function(e){if(e.target.id===j.id&&"height"===e.propertyName){var t=j.querySelectorAll(".exportProgress"),r=A.querySelectorAll(".exportProgress.exportProgressDone, .exportProgress.exportProgressFailed");t.length===r.length&&A.classList.add("hidden"),f()}}),B.addEventListener("click",function(e){e.preventDefault();var t=A.querySelectorAll(".exportProgress.exportProgressDone, .exportProgress.exportProgressFailed");t.length>0&&m();var r=0;j.style.height=j.clientHeight+"px";for(var s=t.length-1;s>-1;s--){var o=t[s];o.addEventListener("transitionend",function(e){"height"===e.propertyName&&e.target.remove()}),o.style.transitionDelay=r+"ms",o.classList.add("clearExportProgress"),r+=80}var n=r-80;j.style.transitionDuration=n+200+150+"ms",j.style.height=j.clientHeight-74*t.length+"px",h.send("clear-exports")}),document.addEventListener("click",function(e){e.button===Zeplin.MOUSE_BUTTON.LEFT&&x()}),document.addEventListener("keydown",function(e){e.keyCode===Zeplin.KEY_CODE.ESC&&x()}),f(),Array.from(document.querySelectorAll("#exportProgressesButton circle")).forEach(function(e){e.setAttribute("r",15)}),F.setAttribute("stroke-dasharray","0 "+P),window.ExportProgresses={hideExportProgressesContainer:x}}}();
//# sourceMappingURL=maps/exportProgresses.js.map
